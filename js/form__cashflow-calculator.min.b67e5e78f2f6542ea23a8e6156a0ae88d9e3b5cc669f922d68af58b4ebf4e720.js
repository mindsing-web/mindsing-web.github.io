(function(){"use strict";function e(e){try{var t=Number(e)||0;return t.toLocaleString("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0})}catch{return"$0"}}function i(t){try{var i,d,u=parseFloat(t.querySelector("#deduct_retirement")?.value)||0,r=parseFloat(t.querySelector("#deduct_health")?.value)||0,c=parseFloat(t.querySelector("#deduct_hsa")?.value)||0,l=parseFloat(t.querySelector("#duduct_monthly_other")?.value)||0,s=u+r+c+l,o=s*12,a=t.querySelector("#average_tax_percent"),n=a?parseFloat(a.value):0;if((!isFinite(n)||n<0)&&(n=0),d=o*(n/100),i=document.getElementById("deduction-benefit-summary"),!i)return;s>0||o>0?i.innerHTML='<p class="mb0"><strong>Total monthly paycheck deductions:</strong> '+e(s)+'</p><p class="mt1 mb0"><strong>Total annual deductions:</strong> '+e(o)+'</p><p class="mt2 mb0"><strong>Estimated annual tax benefit:</strong> '+e(d)+'</p><p class="mt1 mb0"><small>Tax benefit is estimated as total annual deductions × effective tax rate.</small></p>':i.innerHTML=""}catch(e){console.error("[deduction-summary] error",e)}}function n(t){try{var r=parseFloat(t.querySelector("#annual_charity")?.value)||0,o=parseFloat(t.querySelector("#annual_mortgage_interest")?.value)||0,i=parseFloat(t.querySelector("#annual_property_tax")?.value)||0,a=parseFloat(t.querySelector("#annual_other")?.value)||0,s=r+o+i+a,n=document.getElementById("annual-deduction-summary");if(!n)return;if(!s){n.innerHTML="";return}n.innerHTML='<p class="mb0"><strong>Total annual deductions:</strong> '+e(s)+"</p>"}catch(e){console.error("[annual-deduction-summary] error",e)}}function t(t){try{var n,o,i,a,c,d,u,h,m,f,p,v,b,j,y,_,w,O,x,C,E,k,A,S,M,g=document.getElementById("deductions-calculations"),l=document.getElementById("deductions-output");if(!g||!l)return;b=parseFloat(t.querySelector("#deduct_retirement")?.value)||0,O=parseFloat(t.querySelector("#deduct_health")?.value)||0,S=parseFloat(t.querySelector("#deduct_hsa")?.value)||0,v=parseFloat(t.querySelector("#duduct_monthly_other")?.value)||0,i=b+O+S+v,C=parseFloat(t.querySelector("#annual_charity")?.value)||0,x=parseFloat(t.querySelector("#annual_mortgage_interest")?.value)||0,w=parseFloat(t.querySelector("#annual_property_tax")?.value)||0,f=parseFloat(t.querySelector("#annual_other")?.value)||0,a=C+x+w+f,c=a/12,d=t.querySelector("#average_tax_percent"),o=d?parseFloat(d.value):0,(!isFinite(o)||o<0)&&(o=0),j=i*(o/100),y=a*(o/100),_=y/12,m=j+_,p=-(i+c)+m,n="",(i>0||a>0)&&(n='<div class="f6">',i>0&&(n+='<p class="mb2"><strong>Monthly paycheck deductions:</strong> '+e(i)+"</p>"),a>0&&(n+='<p class="mb2"><strong>Monthly impact from annual deductions:</strong> '+e(c)+"</p>"),n+='<p class="mb2"><strong>Total monthly deductions impact:</strong> '+e(i+c)+"</p>",o>0&&(n+='<p class="mb2 green"><strong>Monthly tax savings:</strong> '+e(m)+"</p>",n+='<p class="mb0 f7">Based on '+o+"% effective tax rate</p>"),n+="</div>"),g.innerHTML=n,h=s(t),E=h/12,k=E*(1-o/100),A=k+p,u=!1,M=["annual_salary","spouse_income","additional_income"],M.forEach(function(e){var n=t.querySelector("#"+e);n&&n.value&&parseFloat(n.value)>0&&(u=!0)}),u&&h>0?l.innerHTML='<h3 class="mt0 mb0">Monthly after-tax and deductions income: '+e(A)+"</h3>":l.innerHTML="",r(t)}catch(e){console.error("[deductions-output] error",e)}}function s(e){try{var n=["annual_salary","spouse_income","additional_income"],t=0;return n.forEach(function(n){var s,o=e.querySelector("#"+n);if(!o)return;s=parseFloat(o.value),isFinite(s)||(s=0),t+=s}),t}catch(e){return console.error("form__cashflow computeGrossIncome error:",e),0}}function o(t){try{var n,o,c,l,d,u,h,m,f,a=document.getElementById("income-output");if(!a)return;if(n=s(t),!n){a.innerHTML="";return}d=n/12,c=t.querySelector("#average_tax_percent"),o=c?parseFloat(c.value):0,(!isFinite(o)||o<0)&&(o=0),u=n*(1-o/100),h=u/12,m='<p class="mb0"><strong>Gross income =</strong> '+e(n)+'</p><p class="mt1 mb0"><small>Sum of salary, spouse, and additional income</small></p><p class="mt2 mb0"><strong>Monthly gross income =</strong> '+e(d)+"</p>",f='<h3 class="mt2 mb0"><strong>Monthly after-tax income =</strong> '+e(h)+"</h3>",l=t.querySelector("#income-section-summary"),l&&(l.innerHTML=m),a.innerHTML=f,i(t),r(t)}catch(e){console.error("form__cashflow renderGrossIncome error:",e)}}function u(e){try{var n=["exp_housing","exp_transportation","exp_utilities","exp_extras","exp_life_ins","exp_medical","exp_groceries","exp_dining_travel","exp_childcare","exp_credit_cards","exp_other_debts","exp_savings","exp_other"],t=0;return n.forEach(function(n){var o,s=e.querySelector("#"+n);if(!s)return;o=parseFloat(s.value)||0,t+=o}),t}catch(e){return console.error("[computeMonthlyExpenses] error:",e),0}}function a(t){try{var s,n=document.getElementById("expenses-output");if(!n)return;if(s=u(t),s===0){n.innerHTML='<h3 class="mt0 mb0">Total monthly expenses: Enter expenses above</h3>';return}n.innerHTML='<h3 class="mt0 mb0">Total monthly expenses: '+e(s)+"</h3>",r(t)}catch(e){console.error("[expenses-output] error",e)}}function r(t){try{var o,a,r,c,l,d,h,m,f,p,g,v,b,j,y,_,w,O,x,C,E,k,A,S,M,i=document.getElementById("net-cashflow-amount"),n=document.getElementById("net-cashflow-header");if(!i)return;if(c=s(t)/12,c===0){i&&(i.textContent=""),n&&(n.className=n.className.replace(/ (green|red)/g,""));return}l=t.querySelector("#average_tax_percent"),o=l?parseFloat(l.value):0,(!isFinite(o)||o<0)&&(o=0),A=c*(1-o/100),j=parseFloat(t.querySelector("#deduct_retirement")?.value)||0,g=parseFloat(t.querySelector("#deduct_health")?.value)||0,f=parseFloat(t.querySelector("#deduct_hsa")?.value)||0,_=parseFloat(t.querySelector("#duduct_monthly_other")?.value)||0,r=j+g+f+_,p=parseFloat(t.querySelector("#annual_charity")?.value)||0,h=parseFloat(t.querySelector("#annual_mortgage_interest")?.value)||0,v=parseFloat(t.querySelector("#annual_property_tax")?.value)||0,b=parseFloat(t.querySelector("#annual_other")?.value)||0,d=p+h+v+b,y=d/12,m=r*(o/100),w=d*(o/100),O=w/12,x=m+O,C=-(r+y)+x,E=A+C,k=u(t),a=E-k,S=a>=0?"green":"red",M=a>=0?"+":"",i&&(i.textContent=M+e(a)),n&&(n.className=n.className.replace(/ (green|red)/g,"")+" "+S)}catch(e){console.error("[net-cashflow-output] error",e)}}var m=[{rate:.1,thresh:11e3},{rate:.12,thresh:44725},{rate:.22,thresh:95375},{rate:.24,thresh:182100},{rate:.32,thresh:231250},{rate:.35,thresh:578125},{rate:.37,thresh:1/0}];function h(e){try{if(!isFinite(e)||e<=0)return 0;for(var t,o,r,c,l,i=e,n=0,a=0,s=0;s<m.length;s++){if(t=m[s],o=Math.max(0,Math.min(i,t.thresh-n)),o<=0){n=t.thresh;continue}if(a+=o*t.rate,i-=o,n=t.thresh,i<=0)break}return r=.04*e,c=a+r,l=c/e*100,Math.round(l*100)/100}catch{return 0}}function c(t){try{var n,o,i=document.getElementById("average-tax-help");if(!i)return;if(n=s(t)||0,!n||n<=0){i.textContent="Enter your estimated effective tax rate or use the suggested rate based on gross income.",d(0,0);return}o=h(n),i.innerHTML="Suggested effective tax rate: <strong>"+(o?o+"%":"—")+"</strong> based on gross income of "+e(n)+". You can override in the field above.",d(n,o)}catch{}}function d(t,n){try{var o,s=document.getElementById("annual-tax-liability");if(!s)return;if(!t||!n){s.innerHTML="";return}o=Math.round(t*n/100),s.innerHTML='<p class="mb0"><strong>Estimated annual tax liability:</strong> '+e(o)+"</p>"}catch{}}function f(e){["deduct_retirement","deduct_health","deduct_hsa","duduct_monthly_other"].forEach(function(n){var s=e.querySelector("#"+n);if(!s)return;s.addEventListener("input",function(){i(e),t(e)},!0)});var s,r,u,h,d=e.querySelector("#average_tax_percent");d&&d.addEventListener("input",function(){i(e),t(e)},!0);try{if(!e)return;u=["annual_salary","spouse_income","additional_income"],u.forEach(function(n){var s=e.querySelector("#"+n);if(!s)return;s.addEventListener("blur",function(){o(e),l(e),t(e)},!0),s.addEventListener("change",function(){o(e),l(e),t(e)},!0)}),s=e.querySelector("#average_tax_percent"),s&&s.addEventListener("input",function(){o(e),t(e)},!0),r=e.querySelector("#override-tax-input"),s=e.querySelector("#average_tax_percent"),r&&s&&r.addEventListener("change",function(){r.checked?(s.removeAttribute("readonly"),s.classList.remove("not-allowed"),s.required=!0,s.focus()):(s.setAttribute("readonly","readonly"),s.classList.add("not-allowed"),s.required=!1,l(e),o(e),c(e),t(e))}),["annual_charity","annual_mortgage_interest","annual_property_tax","annual_other"].forEach(function(s){var o=e.querySelector("#"+s);if(!o)return;o.addEventListener("input",function(){n(e),t(e)},!0),o.addEventListener("change",function(){n(e),t(e)},!0),o.addEventListener("blur",function(){n(e),t(e)},!0)}),h=["exp_housing","exp_transportation","exp_utilities","exp_extras","exp_life_ins","exp_medical","exp_groceries","exp_dining_travel","exp_childcare","exp_credit_cards","exp_other_debts","exp_savings","exp_other"],h.forEach(function(t){var n=e.querySelector("#"+t);if(!n)return;n.addEventListener("input",function(){a(e)},!0),n.addEventListener("change",function(){a(e)},!0),n.addEventListener("blur",function(){a(e)},!0)})}catch(e){console.error("form__cashflow attachHandlers error:",e)}}function l(e){try{var o,a,r,t=e.querySelector("#average_tax_percent"),n=e.querySelector("#override-tax-input");if(!t||n&&n.checked)return;o=s(e)||0,a=o?h(o):"",a?t.value=a:t.value="",t.setAttribute("readonly","readonly"),t.classList.add("not-allowed"),t.required=!1;try{r=new Event("input",{bubbles:!0}),t.dispatchEvent(r)}catch{t.fireEvent&&t.fireEvent("oninput")}i(e)}catch{}}document.addEventListener("DOMContentLoaded",function(){try{var m,p,g,v,b,j,y,O,x,k,h=document.getElementById("cashflow-form")||document.querySelector("form.calculator--form");if(!h)return;f(h),i(h),x=h.querySelector("#override-tax-input"),m=h.querySelector("#average_tax_percent"),x&&m&&(x.checked?(m.removeAttribute("readonly"),m.classList.remove("not-allowed"),m.required=!0):(m.setAttribute("readonly","readonly"),m.classList.add("not-allowed"),m.required=!1)),j=s(h),j&&j>0?(o(h),l(h)):l(h),n(h),t(h),a(h),r(h);try{k=window.formCashflow&&window.formCashflow.renderIncomeOutput,["annual_salary","spouse_income","additional_income"].forEach(function(e){var t=h.querySelector("#"+e);if(!t)return;t.addEventListener("blur",function(){c(h)},!0),t.addEventListener("change",function(){c(h)},!0)}),m=h.querySelector("#average_tax_percent"),m&&(m.addEventListener("focus",function(){c(h)},!0),m.addEventListener("input",function(){var t=s(h)||0,e=parseFloat(m.value);!isFinite(e)||e<=0?d(t,0):d(t,e)},!0)),c(h),O=document.getElementById("tax-assumptions-link"),g=document.getElementById("tax-assumptions-modal"),y=document.getElementById("tax-assumptions-close"),O&&g&&O.addEventListener("click",function(e){e.preventDefault(),g.showModal()}),y&&g&&y.addEventListener("click",function(e){e.preventDefault(),g.close()})}catch{}try{h.addEventListener("form:cleared",function(){h.getAttribute("data-cashflow-collapsed")==="true"&&w(h);var e,t,n,s,o,i,a,r=["income-output","income-section-summary","deduction-benefit-summary","deductions-calculations","annual-deduction-summary","deductions-output","expenses-output"];r.forEach(function(e){var t=document.getElementById(e);t&&(t.innerHTML="")}),n=document.getElementById("net-cashflow-amount"),t=document.getElementById("net-cashflow-header"),n&&(n.textContent=""),t&&(t.className=t.className.replace(/ (green|red)/g,"")),e=document.getElementById("average_tax_percent"),e&&(e.value=""),s=document.getElementById("average-tax-help"),s&&(s.textContent="Estimated tax rate."),o=document.getElementById("annual-tax-liability"),o&&(o.innerHTML=""),i=document.getElementById("override-tax-input"),i&&(i.checked=!1),e&&(e.setAttribute("readonly","readonly"),e.required=!1),a=document.getElementById("annual_salary"),a&&a.focus()},!0)}catch{}window.formCashflow=window.formCashflow||{},window.formCashflow.renderIncomeOutput=function(){o(h)},window.formCashflow.collapseToSummary=_,window.formCashflow.expandFromSummary=w,window.formCashflow.renderAnnualDeductions=function(){n(document.getElementById("cashflow-form")||document.querySelector("form.calculator--form"))},["annual_charity","annual_mortgage_interest","annual_property_tax","annual_other"].forEach(function(e){var t=document.getElementById(e);if(!t)return;["input","change","blur"].forEach(function(e){t.addEventListener(e,function(){var e=document.getElementById("cashflow-form")||document.querySelector("form.calculator--form");e&&n(e)},!0)})})}catch(e){console.error("form__cashflow init error:",e)}function _(t){try{if(!t)return;if(t.getAttribute("data-cashflow-collapsed")==="true")return;var n,i,a,r,c,d,h,m,f,p,v,b,j,y,_,O,x,k,A,S,M,F=s(t),g=F/12,l=t.querySelector("#average_tax_percent"),o=l?parseFloat(l.value):0;(!isFinite(o)||o<0)&&(o=0),M=g*(1-o/100),S=parseFloat(t.querySelector("#deduct_retirement")?.value)||0,A=parseFloat(t.querySelector("#deduct_health")?.value)||0,b=parseFloat(t.querySelector("#deduct_hsa")?.value)||0,_=parseFloat(t.querySelector("#duduct_monthly_other")?.value)||0,c=S+A+b+_,f=parseFloat(t.querySelector("#annual_charity")?.value)||0,p=parseFloat(t.querySelector("#annual_mortgage_interest")?.value)||0,h=parseFloat(t.querySelector("#annual_property_tax")?.value)||0,v=parseFloat(t.querySelector("#annual_other")?.value)||0,d=f+p+h+v,j=d/12,y=c*(o/100),m=d*(o/100),O=m/12,x=y+O,k=-(c+j)+x,r=M+k,i=u(t),a=r-i,n=document.createElement("div"),n.className="cashflow-spinner mw7 center pa3",n.setAttribute("role","status"),n.style.textAlign="center",n.textContent="Calculating...";try{t.parentNode.insertBefore(n,t)}catch{}try{t.dataset.cashflowOrigDisplay=t.style.display||""}catch{}setTimeout(function(){try{t.style.display="none"}catch{}var s,c,l,d,u,h,m,f,p,g,o=document.createElement("div");o.id="cashflow-summary",o.className="mw7 center pa3",o.style.opacity="0",o.style.transition="opacity 300ms ease",s="",s+='<p class="mb1"><strong>Monthly Income:</strong> '+e(r)+"</p>",i>0&&(s+='<p class="mb1"><strong>Monthly Expenses:</strong> '+e(i)+"</p>"),g=a>=0?"green":"red",m=a>=0?"+":"",s+='<h3 class="mt4 mb1 '+g+'">Net Income: '+m+e(a)+"</h3>",s+='<div class="mt3" style="display:flex; justify-content:space-between; align-items:center;">',s+='<div class="">',s+='<button id="btn-copy-cashflow" class="btn btn--primary">Copy to clipboard</button>',s+="</div>",s+='<div class="">',s+='<button id="btn-show-cashflow-details" class="btn btn--secondary">Show details</button>',s+="</div>",s+="</div>",u="";try{c="";try{c=(location.search||"").replace(/^\?/,"")}catch{c=""}if(!c&&window.formHelpers&&typeof window.formHelpers.getTokenFromForm=="function")try{c=window.formHelpers.getTokenFromForm(t)||""}catch{c=""}c&&(u=c)}catch{u=""}if(u){s+='<p class="mt2 mb0"><small>Cashflow calculation key:</small></p>',s+='<p class="mt0 mb0"><code class="summary-key" style="user-select: all;">'+C(u)+"</code></p>";try{h="",f=t.querySelector("#notes_cashflow")||document.getElementById("notes_cashflow"),f&&(h=(f.value||"").trim()),h&&(s+='<p class="mt1 mb0 summary-notes"><small>Notes: '+C(h).replace(/\n/g,"<br>")+"</small></p>")}catch{}}o.innerHTML=s;try{t.parentNode.insertBefore(o,t.nextSibling)}catch{}try{n.parentNode&&n.parentNode.removeChild(n)}catch{}try{l=document.querySelector('a[href="/calculator/"]'),l&&(l.style.display="none",l.style.setProperty("display","none","important"),l.parentElement&&(l.parentElement.style.display="none",l.parentElement.style.setProperty("display","none","important")))}catch{}setTimeout(function(){o.style.opacity="1"},20),t.setAttribute("data-cashflow-collapsed","true"),p=o.querySelector("#btn-show-cashflow-details"),p&&p.addEventListener("click",function(){w(t)},!0),d=o.querySelector("#btn-copy-cashflow"),d&&d.addEventListener("click",function(){try{var s,c,l,u,h,n=[];n.push("Cashflow Calculator"),n.push(""),n.push("Monthly Income: "+e(r)),i>0&&n.push("Monthly Expenses: "+e(i)),n.push(""),n.push("Net Income: "+m+e(a)),n.push(""),s="",c=o.querySelector(".summary-key"),c&&(s=(c.textContent||c.innerText||"").trim()),s&&(n.push("Cashflow calculation key:"),n.push(s));try{h=t.querySelector("#notes_cashflow")||document.getElementById("notes_cashflow"),l="",h&&(l=(h.value||"").trim()),l&&(n.push(""),n.push("Notes:"),n.push(l))}catch{}u=n.join(`
`),navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(u).then(function(){d.textContent="Copied",setTimeout(function(){d.textContent="Copy to clipboard"},2e3)}).catch(function(){E(u,d)}):E(u,d)}catch(e){try{console.error("copy error",e)}catch{}}},!0)},300)}catch(e){console.error("collapseToSummary error:",e)}}function w(e){try{if(!e)return;if(e.getAttribute("data-cashflow-collapsed")!=="true")return;var t,s,n=document.getElementById("cashflow-summary");n&&n.parentNode&&n.parentNode.removeChild(n);try{s=e.dataset&&e.dataset.cashflowOrigDisplay,e.style.display=typeof s!="undefined"?s:"";try{delete e.dataset.cashflowOrigDisplay}catch{}}catch{}e.removeAttribute("data-cashflow-collapsed");try{t=document.querySelector('a[href="/calculator/"]'),t&&(t.style.display="",t.style.removeProperty("display"),t.parentElement&&(t.parentElement.style.display="",t.parentElement.style.removeProperty("display")))}catch{}}catch(e){console.error("expandFromSummary error:",e)}}function C(e){return!e&&e!==0?"":String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function E(e,t){try{var s,o,i,n=document.createElement("textarea");n.value=e,n.setAttribute("readonly",""),n.style.position="absolute",n.style.left="-9999px",document.body.appendChild(n),s=document.getSelection().rangeCount>0?document.getSelection().getRangeAt(0):null,n.select();try{o=document.execCommand("copy"),o&&t&&(i=t.textContent,t.textContent="Copied",setTimeout(function(){try{t.textContent=i}catch{}},2e3))}catch{}if(document.body.removeChild(n),s)try{document.getSelection().removeAllRanges(),document.getSelection().addRange(s)}catch{}}catch{}}try{if(h=document.getElementById("cashflow-form")||document.querySelector("form.calculator--form"),h){if(h.addEventListener("submit",async function(e){try{e.preventDefault();try{window.Tracking&&typeof window.Tracking.calculatorCalculate=="function"&&window.Tracking.calculatorCalculate({calculator_type:"cashflow",calculation_method:"form_submit"})}catch(e){console.warn("Cashflow calculation tracking failed:",e)}if(h.getAttribute("data-cashflow-processing")==="true")return;h.setAttribute("data-cashflow-processing","true");var s,c,l,d,u=h.getAttribute("data-token-salt")||null;try{if(window.formHelpers&&typeof window.formHelpers.createEncryptedShareUrl=="function")if(c=await window.formHelpers.createEncryptedShareUrl(h),c)try{history&&history.replaceState?history.replaceState(null,document.title,c):location.href=c}catch{try{location.href=c}catch{}}else{try{showConfirm({title:"Encryption key missing",body:"No stored passphrase was found to encrypt the share link. Unlock the protected content or add a key before sharing.",okText:"OK"})}catch{}return}else if(window.formHelpers&&typeof window.formHelpers.createTokenFromForm=="function")if(s=await window.formHelpers.createTokenFromForm(h,{salt:u}),typeof window.formHelpers.writeTokenToQuery=="function")window.formHelpers.writeTokenToQuery(s);else try{location.search=s}catch{}}catch{try{if(window.formHelpers&&typeof window.formHelpers.createTokenFromForm=="function")if(s=await window.formHelpers.createTokenFromForm(h,{salt:u}),typeof window.formHelpers.writeTokenToQuery=="function")window.formHelpers.writeTokenToQuery(s);else try{location.search=s}catch{}}catch{}}o(h),i(h),n(h),t(h),a(h),r(h);try{if(l=document.activeElement,l&&(l.tagName==="BUTTON"||l.tagName==="INPUT"))try{l.blur()}catch{}d=h.querySelector('button[type="submit"]'),d&&d.blur()}catch{}try{_(h)}catch{}h.removeAttribute("data-cashflow-processing")}catch(e){h.removeAttribute("data-cashflow-processing"),console.error("form__cashflow submit handler error:",e)}},!0),b=h.querySelector('button[type="submit"]')||h.querySelector(".btn--calculate"),!b)for(v=h.querySelectorAll("button"),p=0;p<v.length;p++)if(v[p].textContent&&v[p].textContent.toLowerCase().includes("calculate")){b=v[p];break}b&&b.addEventListener("click",function(e){e.preventDefault(),h.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0}))},!0)}}catch(e){console.error("form__cashflow submit handler init error:",e)}if(document.addEventListener("submit",async function(e){try{var c,l,d,u,h,m,s=e.target;if(!s||s.id!=="cashflow-form"&&!s.classList.contains("calculator--form"))return;if(s.getAttribute("data-cashflow-processing")==="true")return;s.setAttribute("data-cashflow-processing","true"),e.preventDefault(),h=s.getAttribute("data-token-salt")||null;try{if(window.formHelpers&&typeof window.formHelpers.createEncryptedShareUrl=="function")if(d=await window.formHelpers.createEncryptedShareUrl(s),d)try{history&&history.replaceState?history.replaceState(null,document.title,d):location.href=d}catch{try{location.href=d}catch{}}else{try{showConfirm({title:"Encryption key missing",body:"No stored passphrase was found to encrypt the share link. Unlock the protected content or add a key before sharing.",okText:"OK"})}catch{}return}else if(window.formHelpers&&typeof window.formHelpers.createTokenFromForm=="function")if(l=await window.formHelpers.createTokenFromForm(s,{salt:h}),typeof window.formHelpers.writeTokenToQuery=="function")window.formHelpers.writeTokenToQuery(l);else try{location.search=l}catch{}}catch{try{if(window.formHelpers&&typeof window.formHelpers.createTokenFromForm=="function")if(l=await window.formHelpers.createTokenFromForm(s,{salt:h}),typeof window.formHelpers.writeTokenToQuery=="function")window.formHelpers.writeTokenToQuery(l);else try{location.search=l}catch{}}catch{}}try{window.formCashflow&&typeof window.formCashflow.renderIncomeOutput=="function"&&window.formCashflow.renderIncomeOutput(),c=document.getElementById("cashflow-form")||document.querySelector("form.calculator--form"),c&&(o(c),i(c),n(c),t(c),a(c),r(c))}catch(e){console.error("Error updating outputs:",e)}try{if(u=document.activeElement,u&&(u.tagName==="BUTTON"||u.tagName==="INPUT"))try{u.blur()}catch{}m=s.querySelector('button[type="submit"]'),m&&m.blur()}catch{}try{window.formCashflow&&typeof window.formCashflow.collapseToSummary=="function"?window.formCashflow.collapseToSummary(s):_(s)}catch(e){console.error("Error collapsing to summary:",e)}s.removeAttribute("data-cashflow-processing")}catch(e){s.removeAttribute("data-cashflow-processing"),console.error("form__cashflow delegated submit handler error:",e)}},!0),window.collapseSections&&typeof window.collapseSections.init=="function")try{window.collapseSections.init(document.getElementById("cashflow-form")||document)}catch{}},!1)})()