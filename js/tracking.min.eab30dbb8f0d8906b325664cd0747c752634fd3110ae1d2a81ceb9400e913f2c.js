(function(){"use strict";if(window.Tracking&&window.Tracking._initialized)return;if(window.DISABLE_ANALYTICS===!0||window.CALCULATOR_DISABLE_ANALYTICS===!0){window.Tracking={_initialized:!0,_disabled:!0,calculatorCalculate:function(){},passwordAccess:function(){},addKeySuccess:function(){},formInteraction:function(){},contentView:function(){},userAction:function(){},getStatus:function(){return{disabled:!0,reason:"Global kill switch active"}}},console.log("[Tracking] DISABLED via global kill switch");return}window.Tracking=window.Tracking||{},window.dataLayer=window.dataLayer||[];function e(){try{var e,t,n=new URLSearchParams(window.location.search);if(n.get("safe")==="true")return!0}catch{}try{if(navigator.storage&&navigator.storage.estimate&&(!window.localStorage||!window.sessionStorage))return!0}catch{return!0}try{if(e=document.referrer||"",t=window.location.hostname,e&&!e.includes(t))return!0}catch{}return!1}function t(){try{return localStorage.getItem("OWNER_MODE")==="true"}catch{return!1}}function s(e){if(e==null)return!1;var t=String(e);return t.length>20||t.indexOf(" ")!==-1||!!(!isNaN(parseFloat(t))&&isFinite(t))||!!/^[A-Z][a-z]+$/.test(t)||t.indexOf("@")!==-1}function o(e){var t,o,i,a,n={};if(e.event==="calculator_calculate"){n.event=e.event,e.calculator_type&&(e.calculator_type==="dime"||e.calculator_type==="cashflow")&&(n.calculator_type=e.calculator_type);for(a in e)if(s(e[a]))return console.warn('[Tracking] BLOCKED: PII detected in calculator event field "'+a+'"'),null;return n}n.event=e.event;for(i=["action","link_type","link_url","page_section","button_type","form_type","form_action","form_id","nav_url","nav_section","cta_url","is_primary","scroll_depth","page_type","content_type","content_id","page_title","page_path","event_category","event_label"],o=0;o<i.length;o++)if(t=i[o],e[t]!==0[0]&&e[t]!==null){if(s(e[t])){console.warn('[Tracking] BLOCKED: PII detected in field "'+t+'"');continue}n[t]=e[t]}return n}function n(n){if(window.DISABLE_ANALYTICS===!0||window.CALCULATOR_DISABLE_ANALYTICS===!0){console.log("[Tracking] Event blocked: Global kill switch active");return}if(e()){console.log("[Tracking] Event blocked: Compliance-safe mode active");return}if(!t()){console.log("[Tracking] Event blocked: Not in owner mode");return}try{var s=o(n);if(!s){console.warn("[Tracking] Event aborted: Payload failed safety checks");return}if(s.user_name||s.developer_name||s.session_id||s.user_id||s.client_id||s.userName){console.error("[Tracking] CRITICAL: User identifier detected, aborting event");return}window.dataLayer=window.dataLayer||[],window.dataLayer.push(s),console.log("[Tracking] Event sent (compliance-safe):",s)}catch(e){console.warn("[Tracking] Error:",e)}}window.Tracking.calculatorCalculate=function(e){if(e!=="dime"&&e!=="cashflow"){console.warn("[Tracking] Invalid calculator type:",e);return}n({event:"calculator_calculate",calculator_type:e})},window.Tracking.passwordAccess=function(){},window.Tracking.addKeySuccess=function(){},window.Tracking.formInteraction=function(e,t,s){var o,i={event:"form_interaction",form_type:e,form_action:t,event_category:"engagement",event_label:e+"_"+t};if(s&&typeof s=="object")for(o in s)s.hasOwnProperty(o)&&(i[o]=s[o]);n(i)},window.Tracking.contentView=function(e,t,s){var o,i={event:"content_view",content_type:e,content_id:t,event_category:"engagement",event_label:e+"_view"};if(s&&typeof s=="object")for(o in s)s.hasOwnProperty(o)&&(i[o]=s[o]);n(i)},window.Tracking.userAction=function(e,t){var s,o={event:"user_action",action:e,event_category:"engagement",event_label:e};if(t&&typeof t=="object")for(s in t)t.hasOwnProperty(s)&&(o[s]=t[s]);n(o)},window.Tracking.setUserName=function(){},window.Tracking.getUserName=function(){return null},window.Tracking.getStatus=function(){return{trackingModuleLoaded:!0,complianceSafeMode:e(),ownerMode:t(),globalKillSwitch:window.DISABLE_ANALYTICS===!0||window.CALCULATOR_DISABLE_ANALYTICS===!0,trackingEnabled:t()&&!e()&&window.DISABLE_ANALYTICS!==!0&&window.CALCULATOR_DISABLE_ANALYTICS!==!0,dataLayerLength:window.dataLayer?window.dataLayer.length:0}},window.Tracking.enableOwnerMode=function(){try{localStorage.setItem("OWNER_MODE","true"),console.log("[Tracking] Owner mode ENABLED - Analytics active")}catch(e){console.warn("[Tracking] Could not enable owner mode:",e)}},window.Tracking.disableOwnerMode=function(){try{localStorage.removeItem("OWNER_MODE"),console.log("[Tracking] Owner mode DISABLED - Analytics inactive")}catch(e){console.warn("[Tracking] Could not disable owner mode:",e)}},console.log("[Tracking] Compliance-safe module initialized"),console.log("[Tracking] Status:",window.Tracking.getStatus()),t()||(console.log("[Tracking] Analytics DISABLED (not in owner mode)"),console.log("[Tracking] To enable: window.Tracking.enableOwnerMode()")),e()&&console.log("[Tracking] Safe mode ACTIVE - Analytics disabled"),window.Tracking._initialized=!0})()