(function(){"use strict";function e(e){try{var t=Number(e)||0;return t.toLocaleString("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0})}catch{return"$0"}}function d(e){try{var n=["final_expenses","credit_card_debts","car_loans","other_debts"],t=0;return n.forEach(function(n){var s,o=e.querySelector("#"+n);if(!o)return;s=parseFloat(o.value),isFinite(s)||(s=0),t+=s}),t}catch(e){return console.error("form__dime computeDebtValue error:",e),0}}function o(t){try{var s,n=document.getElementById("debt-output");if(!n)return;s=d(t),n.innerHTML='<p class="mb0"><strong>D =</strong> '+e(s)+'</p><p class="mt1 mb0"><small>Total debt and final expense protection</small></p>'}catch(e){console.error("form__dime renderDebtOutput error:",e)}}function c(e){try{var o=e.querySelector("#annual_salary"),s=e.querySelector("#income_multiplier"),t=o?parseFloat(o.value):0,n=s?parseFloat(s.value):0;return isFinite(t)||(t=0),isFinite(n)||(n=0),t*n}catch(e){return console.error("form__dime computeIncomeValue error:",e),0}}function s(t){try{var s,n=document.getElementById("income-output");if(!n)return;s=c(t),n.innerHTML='<p class="mb0"><strong>I =</strong> '+e(s)+'</p><p class="mt1 mb0"><small>Income replacement target (annual salary Ã— multiplier)</small></p>'}catch(e){console.error("form__dime renderIncomeOutput error:",e)}}function u(e){try{var a=e.querySelector("#monthly_rent"),o=e.querySelector("#months_rent"),i=e.querySelector("#mortgage_balance"),t=a?parseFloat(a.value):0,n=o?parseFloat(o.value):0,s=i?parseFloat(i.value):0;return isFinite(t)||(t=0),isFinite(n)||(n=0),isFinite(s)||(s=0),t*n+s}catch(e){return console.error("form__dime computeMortgageValue error:",e),0}}function t(t){try{var s,n=document.getElementById("mortgage-output");if(!n)return;s=u(t),n.innerHTML='<p class="mb0"><strong>M =</strong> '+e(s)+'</p><p class="mt1 mb0"><small>Provides basic living cost replacement protection</small></p>'}catch(e){console.error("form__dime renderMortgageOutput error:",e)}}function r(e){try{var o=e.querySelector("#student_loans"),s=e.querySelector("#dependent_education"),t=o?parseFloat(o.value):0,n=s?parseFloat(s.value):0;return isFinite(t)||(t=0),isFinite(n)||(n=0),{loans:t,dependent:n,total:t+n}}catch(e){return console.error("form__dime computeEducationValue error:",e),{loans:0,dependent:0,total:0}}}function n(t){try{var s,n=document.getElementById("education-output");if(!n)return;s=r(t),n.innerHTML='<p class="mb0"><strong>E =</strong> '+e(s.total)+'</p><p class="mt1 mb0"><small>Covers outstanding student loans and dependent education needs</small></p>'}catch(e){console.error("form__dime renderEducationOutput error:",e)}}function l(e){try{var o=d(e),t=c(e),n=u(e),s=r(e).total||0;return o+t+n+s}catch(e){return console.error("form__dime computeDimeValue error:",e),0}}function i(t){try{var s,n=document.getElementById("dime-output");if(!n)return;s=l(t),n.innerHTML='<h3 class="mb0 underline">DIME Coverage Target = <em>'+e(s)+'</em></h3><p class="mt1 mb0"><small>Combined total of debt, income replacement, mortgage, and education needs</small></p>'}catch(e){console.error("form__dime renderDimeOutput error:",e)}}function m(e){try{var n,o=l(e)||0,s=e.querySelector("#current_insurance"),t=s?parseFloat(s.value):0;return isFinite(t)||(t=0),n=o-t,(!isFinite(n)||n<0)&&(n=0),{target:o,inForce:t,need:n}}catch(e){return console.error("form__dime computeCoverageNeed error:",e),{target:0,inForce:0,need:0}}}function a(t){try{var n,s=document.getElementById("coverage-need-output");if(!s)return;n=m(t),s.innerHTML='<h2 class="mb0"><u>Total Coverage Need = <em>'+e(n.need)+'</em></u></h2><p class="mt1 mb0"><small>DIME Coverage Target ('+e(n.target)+") - in-force ("+e(n.inForce)+") = Total Coverage Need</small></p>"}catch(e){console.error("form__dime renderCoverageNeed error:",e)}}function f(t){try{if(!t)return;if(t.getAttribute("data-dime-collapsed")==="true")return;var h=d(t),o=c(t),i=u(t),a=r(t).total||0,n=m(t),s=document.createElement("div");s.className="dime-spinner mw7 center pa3",s.setAttribute("role","status"),s.style.textAlign="center",s.textContent="Calculating...";try{t.parentNode.insertBefore(s,t)}catch{}try{t.dataset.dimeOrigDisplay=t.style.display||""}catch{}setTimeout(function(){try{t.style.display="none"}catch{}var r,d,u,m,f,j,y,_,c=document.createElement("div");c.id="dime-summary",c.className="mw7 center pa3",c.style.opacity="0",c.style.transition="opacity 300ms ease",r="",r+='<p class="mb1"><strong>D =</strong> '+e(h)+" <small>(Debt)</small></p>",r+='<p class="mb1"><strong>I =</strong> '+e(o)+" <small>(Income)</small></p>",r+='<p class="mb1"><strong>M =</strong> '+e(i)+" <small>(Mortgage)</small></p>",r+='<p class="mb2"><strong>E =</strong> '+e(a)+" <small>(Education)</small></p>",n&&n.inForce&&n.inForce>0&&(typeof n.target!="undefined"&&(r+='<p class="mb1"><small><u>DIME Target: <em>'+e(n.target)+"</em></u></small></p>"),r+='<p class="mb1"><small>Current in-force: '+e(n.inForce)+"</small></p>"),r+='<h3 class="mt4 mb1">Life Insurance Target: '+e(n?n.need:l(t))+"</h3>",r+='<div class="mt3" style="display:flex; justify-content:space-between; align-items:center;">',r+='<div class="">',r+='<button id="btn-copy-target" class="btn btn--primary">Copy to clipboard</button>',r+="</div>",r+='<div class="">',r+='<button id="btn-show-details" class="btn btn--secondary">Show details</button>',r+="</div>",r+="</div>",f="";try{d="";try{d=(location.search||"").replace(/^\?/,"")}catch{d=""}if(!d&&window.formHelpers&&typeof window.formHelpers.getTokenFromForm=="function")try{d=window.formHelpers.getTokenFromForm(t)||""}catch{d=""}d&&(f=d)}catch{f=""}if(f){r+='<p class="mt2 mb0"><small>Insurance target key:</small></p>',r+='<p class="mt0 mb0"><code class="summary-key" style="user-select: all;">'+g(f)+"</code></p>";try{j="",y=t.querySelector("#notes_dime")||document.getElementById("notes_dime"),y&&(j=(y.value||"").trim()),j&&(r+='<p class="mt1 mb0 summary-notes"><small>Notes: '+g(j).replace(/\n/g,"<br>")+"</small></p>")}catch{}}c.innerHTML=r;try{t.parentNode.insertBefore(c,t.nextSibling)}catch{}try{s.parentNode&&s.parentNode.removeChild(s)}catch{}try{u=document.querySelector('a[href="/calculator/"]'),u&&(u.style.display="none",u.style.setProperty("display","none","important"),u.parentElement&&(u.parentElement.style.display="none",u.parentElement.style.setProperty("display","none","important")))}catch{}setTimeout(function(){c.style.opacity="1"},20),t.setAttribute("data-dime-collapsed","true");try{b()}catch{}_=c.querySelector("#btn-show-details")||document.getElementById("btn-show-details"),_&&_.addEventListener("click",function(){p(t)},!0),m=c.querySelector("#btn-copy-target")||document.getElementById("btn-copy-target"),m&&m.addEventListener("click",function(){try{var r,d,u,f,p,g,b,j,s=[];s.push("DIME Calculator"),s.push("");try{s.push("D: "+e(h)+" (Debt)"),s.push("I: "+e(o)+" (Income)"),s.push("M: "+e(i)+" (Mortgage)"),s.push("E: "+e(a)+" (Education)")}catch{}try{n&&n.inForce&&n.inForce>0&&(typeof n.target!="undefined"&&s.push("DIME Target: "+e(n.target)),s.push("Current in-force: "+e(n.inForce)))}catch{}try{s.push(""),s.push("Life Insurance Target: "+e(n?n.need:l(t)))}catch{}if(s.push(""),r="",d=c.querySelector(".summary-key"),d||(d=document.querySelector(".summary-key")),d&&(r=(d.textContent||d.innerText||"").trim()),!r)try{g=(location.search||"").replace(/^\?/,""),b=g.split("&").reduce(function(e,t){var n=t.split("=");return n.length===1?e:(e[decodeURIComponent(n[0])]=decodeURIComponent(n.slice(1).join("=")),e)},{}),r=b.token||b.key||g||""}catch{r=(location.search||"").replace(/^\?/,"")}r&&s.push("Insurance target key: "+r);try{j=t.querySelector("#notes_dime")||document.getElementById("notes_dime"),u="",j&&(u=(j.value||"").trim()),u||(f=c.querySelector(".summary-notes"),f&&(u=(f.textContent||f.innerText||"").trim())),u&&(s.push(""),s.push("Notes:"),s.push(u))}catch{}p=s.join(`
`),navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(p).then(function(){m.textContent="Copied",setTimeout(function(){m.textContent="Copy to clipboard"},2e3)}).catch(function(){v(p,m)}):v(p,m)}catch(e){try{console.error("copy error",e)}catch{}}},!0)},300)}catch(e){console.error("collapseToSummary error:",e)}}function p(e){try{if(!e)return;if(e.getAttribute("data-dime-collapsed")!=="true")return;var t,s,n=document.getElementById("dime-summary");n&&n.parentNode&&n.parentNode.removeChild(n);try{s=e.dataset&&e.dataset.dimeOrigDisplay,e.style.display=typeof s!="undefined"?s:"";try{delete e.dataset.dimeOrigDisplay}catch{}}catch{}e.removeAttribute("data-dime-collapsed");try{j()}catch{}try{t=document.querySelector('a[href="/calculator/"]'),t&&(t.style.display="",t.style.removeProperty("display"),t.parentElement&&(t.parentElement.style.display="",t.parentElement.style.removeProperty("display")))}catch{}}catch(e){console.error("expandFromSummary error:",e)}}function b(){try{var e,t,n=document.querySelector('a[href="/calculator/"]');n&&(n.dataset._display=n.style.display||"",n.style.display="none",n.setAttribute("aria-hidden","true"))}catch{}try{e=document.getElementById("btn-add-key"),e&&(e.dataset._disabled=e.disabled?"1":"0",e.disabled=!0,e.classList.add("btn--disabled"),e.setAttribute("aria-disabled","true"))}catch{}try{if(t=document.getElementById("btn-toggle-notes")||document.querySelector(".btn--notes-toggle"),t){t.dataset._disabled=t.disabled?"1":"0";try{t.disabled=!0}catch{}t.classList.add("btn--disabled"),t.setAttribute("aria-disabled","true")}}catch{}}function j(){try{var e,t,n=document.querySelector('a[href="/calculator/"]');if(n){n.style.display=n.dataset._display||"";try{delete n.dataset._display}catch{}n.removeAttribute("aria-hidden")}}catch{}try{if(e=document.getElementById("btn-add-key"),e){e.disabled=e.dataset._disabled==="1",e.classList.remove("btn--disabled"),e.removeAttribute("aria-disabled");try{delete e.dataset._disabled}catch{}}}catch{}try{if(t=document.getElementById("btn-toggle-notes")||document.querySelector(".btn--notes-toggle"),t){try{t.disabled=t.dataset._disabled==="1"}catch{}t.classList.remove("btn--disabled"),t.removeAttribute("aria-disabled");try{delete t.dataset._disabled}catch{}}}catch{}}function g(e){return!e&&e!==0?"":String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function v(e,t){try{var s,o,i,n=document.createElement("textarea");n.value=e,n.setAttribute("readonly",""),n.style.position="absolute",n.style.left="-9999px",document.body.appendChild(n),s=document.getSelection().rangeCount>0?document.getSelection().getRangeAt(0):null,n.select();try{o=document.execCommand("copy"),o&&t&&(i=t.textContent,t.textContent="Copied",setTimeout(function(){try{t.textContent=i}catch{}},2e3))}catch{}if(document.body.removeChild(n),s)try{document.getSelection().removeAllRanges(),document.getSelection().addRange(s)}catch{}}catch{}}function h(e){e=e||document;try{var c,l,d,u,h,m,p,g,v,b,r=e.querySelector("#dime-form");if(!r)return;r.addEventListener("form:cleared",function(){try{var e=["debt-output","income-output","mortgage-output","education-output","dime-output","coverage-need-output"];e.forEach(function(e){var t=document.getElementById(e);t&&(t.innerHTML="")})}catch(e){console.error("form__dime clear outputs error:",e)}},!0),o(r),v=["final_expenses","credit_card_debts","car_loans","other_debts"],v.forEach(function(e){var t=r.querySelector("#"+e);if(!t)return;t.addEventListener("blur",function(){o(r)},!0),t.addEventListener("change",function(){o(r)},!0)}),s(r),c=r.querySelector("#annual_salary"),l=r.querySelector("#income_multiplier"),c&&(c.addEventListener("blur",function(){s(r)},!0),c.addEventListener("change",function(){s(r)},!0)),l&&(l.addEventListener("blur",function(){s(r)},!0),l.addEventListener("change",function(){s(r)},!0)),t(r),d=r.querySelector("#monthly_rent"),u=r.querySelector("#months_rent"),h=r.querySelector("#mortgage_balance"),d&&(d.addEventListener("blur",function(){t(r)},!0),d.addEventListener("change",function(){t(r)},!0)),u&&(u.addEventListener("blur",function(){t(r)},!0),u.addEventListener("change",function(){t(r)},!0)),h&&(h.addEventListener("blur",function(){t(r)},!0),h.addEventListener("change",function(){t(r)},!0)),n(r),m=r.querySelector("#student_loans"),p=r.querySelector("#dependent_education"),m&&(m.addEventListener("blur",function(){n(r)},!0),m.addEventListener("change",function(){n(r)},!0)),p&&(p.addEventListener("blur",function(){n(r)},!0),p.addEventListener("change",function(){n(r)},!0)),i(r),a(r),b=["final_expenses","credit_card_debts","car_loans","other_debts","annual_salary","income_multiplier","monthly_rent","months_rent","mortgage_balance","student_loans","dependent_education","current_insurance"],b.forEach(function(e){var t=r.querySelector("#"+e);if(!t)return;t.addEventListener("blur",function(){i(r),a(r)},!0),t.addEventListener("change",function(){i(r),a(r)},!0)}),r.addEventListener("submit",async function(e){try{e.preventDefault();var c,l,d,u,h=r.getAttribute("data-token-salt")||null;try{if(window.formHelpers&&typeof window.formHelpers.createEncryptedShareUrl=="function")if(l=await window.formHelpers.createEncryptedShareUrl(r),l){try{console.debug("form__dime: created encrypted share url")}catch{}try{history&&history.replaceState?history.replaceState(null,document.title,l):location.href=l}catch{try{location.href=l}catch{}}}else{try{console.debug("form__dime: no stored passphrase available, cannot produce encrypted URL")}catch{}try{showConfirm({title:"Encryption key missing",body:"No stored passphrase was found to encrypt the share link. Unlock the protected content or add a key before sharing.",okText:"OK"})}catch{}return}else if(window.formHelpers&&typeof window.formHelpers.createTokenFromForm=="function")if(c=await window.formHelpers.createTokenFromForm(r,{salt:h}),typeof window.formHelpers.writeTokenToQuery=="function")window.formHelpers.writeTokenToQuery(c);else try{location.search=c}catch{}}catch{try{if(window.formHelpers&&typeof window.formHelpers.createTokenFromForm=="function")if(c=await window.formHelpers.createTokenFromForm(r,{salt:h}),typeof window.formHelpers.writeTokenToQuery=="function")window.formHelpers.writeTokenToQuery(c);else try{location.search=c}catch{}}catch{}}o(r),s(r),t(r),n(r),i(r),a(r);try{if(d=document.activeElement,d&&(d.tagName==="BUTTON"||d.tagName==="INPUT"))try{d.blur()}catch{}try{u=r.querySelector('button[type="submit"]'),u&&u.blur()}catch{}}catch{}try{setTimeout(function(){try{var t,e=document.activeElement;if(e&&(e.tagName==="BUTTON"||e.tagName==="INPUT"))try{e.blur()}catch{}if(t=r.querySelector('button[type="submit"]'),t)try{t.blur()}catch{}}catch{}},50)}catch{}try{f(r)}catch{}}catch(e){console.error("form__dime submit handler error:",e)}},!0);try{r.setAttribute("data-dime-handler-bound","true")}catch{}try{g=r.querySelector("#btn-toggle-notes")||document.getElementById("btn-toggle-notes")||document.querySelector(".btn--notes-toggle"),g&&g.addEventListener("click",function(){try{window.formHelpers&&typeof window.formHelpers.openNotes=="function"&&window.formHelpers.openNotes(r,"notes_dime")}catch{}},!0),r.addEventListener("form:cleared",function(){try{window.formHelpers&&typeof window.formHelpers.closeNotes=="function"&&window.formHelpers.closeNotes()}catch{}},!0)}catch(e){console.error("form__dime notes dialog init error",e)}}catch(e){console.error("form__dime initDebtOutput error:",e)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",function(){h(document)}):h(document),document.addEventListener("submit",async function(e){try{var n,s,o,i,a,t=e.target;if(!t||t.id!=="dime-form")return;if(t.getAttribute&&t.getAttribute("data-dime-handler-bound")==="true")return;e.preventDefault(),i=t.getAttribute("data-token-salt")||null;try{if(window.formHelpers&&typeof window.formHelpers.createEncryptedShareUrl=="function")if(s=await window.formHelpers.createEncryptedShareUrl(t),s)try{history&&history.replaceState?history.replaceState(null,document.title,s):location.href=s}catch{try{location.href=s}catch{}}else{try{console.debug("form__dime delegated submit: no stored passphrase available, cannot produce encrypted URL")}catch{}try{showConfirm({title:"Encryption key missing",body:"No stored passphrase was found to encrypt the share link. Unlock the protected content or add a key before sharing.",okText:"OK"})}catch{}return}else if(window.formHelpers&&typeof window.formHelpers.createTokenFromForm=="function")if(n=await window.formHelpers.createTokenFromForm(t,{salt:i}),typeof window.formHelpers.writeTokenToQuery=="function")window.formHelpers.writeTokenToQuery(n);else try{location.search=n}catch{}}catch{try{if(window.formHelpers&&typeof window.formHelpers.createTokenFromForm=="function")if(n=await window.formHelpers.createTokenFromForm(t,{salt:i}),typeof window.formHelpers.writeTokenToQuery=="function")window.formHelpers.writeTokenToQuery(n);else try{location.search=n}catch{}}catch{}}try{window.formDime&&typeof window.formDime.renderDebtOutput=="function"&&window.formDime.renderDebtOutput(t),window.formDime&&typeof window.formDime.renderIncomeOutput=="function"&&window.formDime.renderIncomeOutput(t),window.formDime&&typeof window.formDime.renderMortgageOutput=="function"&&window.formDime.renderMortgageOutput(t),window.formDime&&typeof window.formDime.renderEducationOutput=="function"&&window.formDime.renderEducationOutput(t),window.formDime&&typeof window.formDime.renderDimeOutput=="function"&&window.formDime.renderDimeOutput(t),window.formDime&&typeof window.formDime.renderCoverageNeed=="function"&&window.formDime.renderCoverageNeed(t);try{if(o=document.activeElement,o&&(o.tagName==="BUTTON"||o.tagName==="INPUT"))try{o.blur()}catch{}try{a=t.querySelector('button[type="submit"]'),a&&a.blur()}catch{}}catch{}try{setTimeout(function(){try{var n,e=document.activeElement;if(e&&(e.tagName==="BUTTON"||e.tagName==="INPUT"))try{e.blur()}catch{}if(n=t.querySelector('button[type="submit"]'),n)try{n.blur()}catch{}}catch{}},50)}catch{}}catch(e){console.error("form__dime delegated submit handler error:",e)}}catch(e){console.error("form__dime delegated submit listener error:",e)}},!0),window.formDime={initDebtOutput:h,computeDebtValue:d,renderDebtOutput:o,computeIncomeValue:c,renderIncomeOutput:s,computeMortgageValue:u,renderMortgageOutput:t,computeEducationValue:r,renderEducationOutput:n,collapseToSummary:f,expandFromSummary:p}})()