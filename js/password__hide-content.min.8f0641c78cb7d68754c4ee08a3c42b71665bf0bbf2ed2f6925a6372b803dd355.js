(function(){"use strict";function o(e,t){return(t||document).querySelector(e)}function s(e,t){return Array.prototype.slice.call((t||document).querySelectorAll(e))}function t(e,t,n){var s=document.createElement(e);return t=t||{},Object.keys(t).forEach(function(e){s.setAttribute(e,t[e])}),n&&(s.textContent=n),s}function e(t,n){n=n||{},this.root=t,this.id=n.id||t.getAttribute("data-protect-id")||"default",this.storageKey="password_gate_unlocked:"+this.id,this.password=n.password||t.getAttribute("data-password")||"",this.passwordHash=null,e.hashStore=e.hashStore||{};try{var o,i,a,r,s=t.closest?t.closest("main"):document.querySelector("main");if(s&&s.getAttribute)try{if(o=s.getAttribute("data-protect-password-hash"),i=s.getAttribute("data-protect-password"),o){e.hashStore[this.id]=e.hashStore[this.id]||{},e.hashStore[this.id].hash=o;try{s.removeAttribute("data-protect-password-hash")}catch{}this.passwordHash=o}else if(i){e.hashStore[this.id]=e.hashStore[this.id]||{},e.hashStore[this.id].plain=i;try{s.removeAttribute("data-protect-password")}catch{}this.password=i}}catch{}}catch{}this.buttonSelector=n.buttonSelector||".btn--access-content",this.button=null,this.overlay=null,this.actionBar=document.querySelector(".action-bar");try{e.hashStore=e.hashStore||{},e.hashStore[this.id]&&(e.hashStore[this.id].hash&&(this.passwordHash=e.hashStore[this.id].hash),e.hashStore[this.id].plain&&(this.password=e.hashStore[this.id].plain))}catch{}try{}catch{}if(this.actionBar){this.actionBar.classList.add("pw-action-hidden");try{if(r=this.actionBar.parentNode,r){a=document.createElement("div"),a.className="pw-actionbar-placeholder";try{r.replaceChild(a,this.actionBar)}catch{}this._actionBarOriginal=this.actionBar,this._actionBarPlaceholder=a,this._actionBarDetached=!0}}catch{}}this.init()}e.prototype.isUnlocked=function(){try{return localStorage.getItem(this.storageKey)==="1"}catch{return!1}},e.prototype.setUnlocked=function(e){try{e?localStorage.setItem(this.storageKey,"1"):localStorage.removeItem(this.storageKey)}catch{}},e.prototype.showContent=function(){if(this._detached&&this._placeholder&&this._originalNode)try{this._placeholder.parentNode.replaceChild(this._originalNode,this._placeholder),this.root=this._originalNode}catch{}if(this.root.style.display="",this.root.removeAttribute("aria-hidden"),this._actionBarDetached&&this._actionBarPlaceholder&&this._actionBarOriginal)try{this._actionBarPlaceholder.parentNode.replaceChild(this._actionBarOriginal,this._actionBarPlaceholder),this.actionBar=this._actionBarOriginal}catch{}this.actionBar&&this.actionBar.classList.remove("pw-action-hidden");try{document.body.classList.add("pw-unlocked")}catch{}try{window.formHelpers&&typeof window.formHelpers.flushDeferredInfoTooltips=="function"&&window.formHelpers.flushDeferredInfoTooltips()}catch{}try{document.body.classList.remove("pw-content-hidden")}catch{}if(!this.button)return;try{var e,n,s,o,t=null;try{t=this.button.closest?this.button.closest(".password-access-wrapper"):null}catch{t=null}if(t&&t.parentNode)t.remove?t.remove():t.parentNode.removeChild(t);else{e=this.button.parentNode;try{this.button.remove?this.button.remove():e&&e.removeChild(this.button)}catch{}try{if(e&&e.parentNode){for(n=!0,s=0;s<e.childNodes.length;s++){if(o=e.childNodes[s],o.nodeType===1){n=!1;break}if(o.nodeType===3&&(o.textContent||"").trim()!==""){n=!1;break}}n&&(e.remove?e.remove():e.parentNode.removeChild(e))}}catch{}}}catch{try{this.button.style.display="none"}catch{}}this.button=null},e.prototype.hideContent=function(){try{if(!this._detached&&this.root&&this.root.parentNode){var t,e=document.createElement("div");e.className="pw-protected-placeholder",e.setAttribute("aria-hidden","true");try{this.root.parentNode.replaceChild(e,this.root)}catch{}this._originalNode=this.root,this._placeholder=e,this._detached=!0}}catch{}try{this.root.style.display="none"}catch{}try{this.root.setAttribute&&this.root.setAttribute("aria-hidden","true")}catch{}if(this.button)try{this.button.classList.remove("pw-access-visible")}catch{}this.actionBar&&this.actionBar.classList.add("pw-action-hidden");try{document.body.classList.remove("pw-unlocked")}catch{}try{t=!!document.querySelector(".btn--access-content.pw-access-visible"),t||document.body.classList.add("pw-buttons-hidden");try{document.body.classList.add("pw-content-hidden")}catch{}}catch{}},e.prototype.buildOverlay=function(){var e,n,s,o,a,c,l,d,u,h,f,p,i=this,r=t("div",{class:"password-gate-overlay",role:"dialog","aria-modal":"true"});r.style.position="fixed",r.style.inset="0",r.style.display="flex",r.style.alignItems="center",r.style.justifyContent="center",r.style.background="rgba(0,0,0,0.6)",r.style.zIndex=3e4,o=t("div",{class:"password-gate-box"}),o.style.background="#fff",o.style.padding="20px",o.style.borderRadius="6px",o.style.maxWidth="420px",o.style.width="90%",o.style.boxShadow="0 6px 24px rgba(0,0,0,0.3)",h=t("h3",{},"Enter your details to access content"),h.style.marginTop="0",f=t("p",{},"Please provide your name and the password to access this protected content."),a=t("form",{class:"password-gate-form"}),a.style.margin="0",c=t("label",{for:"password-gate-name-input"}),c.innerHTML='Your Name <span style="color: red;">*</span>',c.style.display="block",c.style.marginTop="12px",c.style.marginBottom="4px",c.style.fontWeight="bold",n=t("input",{type:"text",class:"password-gate-name-input",id:"password-gate-name-input","aria-label":"Your Name (required)",placeholder:"Enter your name",required:"required",minlength:"2",maxlength:"50",pattern:"[a-zA-Z\\s\\-\\.]+",title:"Please enter your name (2-50 characters, letters only)"}),n.style.width="100%",n.style.padding="8px 10px",n.style.marginTop="2px",n.style.boxSizing="border-box",n.style.border="1px solid #ccc",n.style.borderRadius="4px",l=t("label",{for:"password-gate-input"}),l.innerHTML='Password <span style="color: red;">*</span>',l.style.display="block",l.style.marginTop="12px",l.style.marginBottom="4px",l.style.fontWeight="bold",e=t("input",{type:"password",class:"password-gate-input",id:"password-gate-input","aria-label":"Password (required)",placeholder:"Enter password",required:"required",minlength:"1"}),e.style.width="100%",e.style.padding="8px 10px",e.style.marginTop="2px",e.style.boxSizing="border-box",e.style.border="1px solid #ccc",e.style.borderRadius="4px",s=t("div",{class:"password-gate-error"}),s.style.color="red",s.style.minHeight="18px",s.style.marginTop="8px",d=t("div",{class:"password-gate-controls"}),d.style.marginTop="12px",d.style.textAlign="right",u=t("button",{type:"button",class:"btn btn--secondary password-gate-cancel"},"Cancel"),p=t("button",{type:"submit",class:"btn btn--primary password-gate-ok"},"Enter"),u.style.marginRight="8px",d.appendChild(u),d.appendChild(p),a.appendChild(c),a.appendChild(n),a.appendChild(l),a.appendChild(e),a.appendChild(s),a.appendChild(d),o.appendChild(h),o.appendChild(f),o.appendChild(a),r.appendChild(o);function g(e,t){e.style.borderColor="#dc3545",e.style.boxShadow="0 0 0 0.2rem rgba(220, 53, 69, 0.25)",s.textContent=t,s.style.display="block"}function v(e){e.style.borderColor="#28a745",e.style.boxShadow="0 0 0 0.2rem rgba(40, 167, 69, 0.25)"}function b(e){e.style.borderColor="#ccc",e.style.boxShadow="none"}n.addEventListener("invalid",function(e){e.preventDefault(),g(n,this.validationMessage||"Please enter a valid name")}),e.addEventListener("invalid",function(t){t.preventDefault(),g(e,this.validationMessage||"Please enter the password")}),n.addEventListener("input",function(){this.validity.valid?(v(this),s.textContent=""):b(this)}),e.addEventListener("input",function(){this.validity.valid?(v(this),s.textContent=""):b(this)});function m(){try{document.body.removeChild(r)}catch{}document.removeEventListener("keydown",j,!0)}function j(t){if(t.key==="Escape"&&m(),t.key==="Enter"){if(document.activeElement===n){e.focus(),t.preventDefault();return}a.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0}))}}return u.addEventListener("click",function(){m()}),a.addEventListener("submit",function(t){t.preventDefault();var a=e.value||"",o=n.value||"";s.textContent="",async function(){var n,r,c,t=!1;try{i.passwordHash&&window.crypto&&window.crypto.subtle?(n=(new TextEncoder).encode(a),r=await window.crypto.subtle.digest("SHA-256",n),c=Array.prototype.map.call(new Uint8Array(r),function(e){return("00"+e.toString(16)).slice(-2)}).join(""),c===i.passwordHash&&(t=!0)):a===i.password&&(t=!0)}catch{t=!1}if(t){i.setUnlocked(!0);try{sessionStorage.setItem("password_gate:"+i.id,a)}catch{}try{localStorage.setItem("password_gate:"+i.id,a)}catch{}try{sessionStorage.setItem("password_gate_user:"+i.id,o.trim())}catch{}try{localStorage.setItem("password_gate_user:"+i.id,o.trim())}catch{}if(window.Tracking)window.Tracking.setUserName(o.trim()),window.Tracking.passwordAccess(i.id,o.trim());else{try{localStorage.setItem("ga4_user_name",o.trim())}catch{}try{sessionStorage.setItem("ga4_user_name",o.trim())}catch{}try{window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"password_protected_access",user_name:o.trim(),protection_id:i.id,event_category:"engagement",event_label:"protected_content_access"})}catch(e){console.warn("GA4 tracking error:",e)}}m(),i.showContent()}else s.textContent="Incorrect password",e.focus()}()}),document.addEventListener("keydown",j,!0),r},e.prototype.init=function(){var n,e=this,s=null;try{s=document.querySelector(this.buttonSelector+'[data-protect-id="'+this.id+'"]')||document.querySelector(this.buttonSelector)}catch{}if(this.button=s,this.isUnlocked()){this.showContent();return}if(this.hideContent(),!this.button){n=t("button",{type:"button",class:"btn btn--primary btn--access-content","data-protect-id":this.id},"Access Content"),this.button=n;try{this.root.parentNode.insertBefore(n,this.root)}catch{}}this.button.addEventListener("click",function(t){t.preventDefault();try{e.overlay=e.buildOverlay(),document.body.appendChild(e.overlay);var n=e.overlay.querySelector(".password-gate-name-input");n&&n.focus()}catch(e){console.error("PasswordGate open error",e)}},!0);try{if(!this.isUnlocked()){try{this.button.classList.add("pw-access-visible")}catch{}try{document.body.classList.remove("pw-buttons-hidden")}catch{}}}catch{}};function n(){s(".js-password-protected").forEach(function(t){try{var s={id:t.getAttribute("data-protect-id")||0[0],buttonSelector:".btn--access-content"},n=t.getAttribute("data-password");n&&(s.password=n),new e(t,s)}catch(e){console.error("PasswordGate init error",e)}})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n):n(),window.PasswordGate=e})()