(function(){"use strict";function u(e){e=e||document;try{var n="input[required], select[required], textarea[required]",t=e.querySelectorAll(n);t.forEach(function(e){var t,s,o=e.id,n=o?document.querySelector('label[for="'+o+'"]'):null;if(!n)for(t=e.parentElement;t&&t!==document.body;){if(t.tagName&&t.tagName.toLowerCase()==="label"){n=t;break}t=t.parentElement}if(!n)return;if(n.querySelector(".required-asterisk"))return;s=document.createElement("span"),s.className="required-asterisk",s.textContent="*",n.insertBefore(s,n.firstChild)})}catch(e){console.error("form__helpers addAsterisks error:",e)}}function o(e){e=e||document;try{var n=20,t=Array.prototype.slice.call(e.querySelectorAll("a.info"));t.forEach(function(e,t){e.setAttribute("role","button"),e.setAttribute("tabindex",e.getAttribute("tabindex")||"0");var s,o,a,d,u,h=e.getAttribute("title")||e.getAttribute("data-title")||"";if(!h)return;e.removeAttribute("title"),o=parseInt(e.getAttribute("data-tooltip-offset"),10)||n,s=document.createElement("div"),s.className="info-tooltip",s.setAttribute("role","tooltip"),d="info-tooltip-"+(e.id||"fh"+t),s.id=d,s.textContent=h,s.style.position="absolute",s.style.zIndex=1e4,s.style.background="rgba(0,0,0,0.9)",s.style.color="white",s.style.padding="6px 8px",s.style.borderRadius="4px",s.style.fontSize="13px",s.style.maxWidth="260px",s.style.boxShadow="0 2px 6px rgba(0,0,0,0.3)",s.style.display="none",e.setAttribute("aria-haspopup","true"),e.setAttribute("aria-expanded","false"),e.setAttribute("aria-controls",d);function i(){try{document.body.appendChild(s)}catch{}}if(window.PasswordGate&&typeof window.PasswordGate=="function")try{u=!!document.querySelector(".js-password-protected"),u?(window.formHelpers=window.formHelpers||{},window.formHelpers._deferredInfoTooltips=window.formHelpers._deferredInfoTooltips||[],window.formHelpers._deferredInfoTooltips.push(i)):i()}catch{i()}else i();function r(){var n,t=e.getBoundingClientRect(),i=window.scrollY||window.pageYOffset,a=window.scrollX||window.pageXOffset,r=t.top+i-s.offsetHeight-o;r<i+o&&(r=t.bottom+i+o),n=t.left+a+t.width/2-s.offsetWidth/2,n=Math.max(a+o,Math.min(n,a+document.documentElement.clientWidth-s.offsetWidth-o)),s.style.top=r+"px",s.style.left=n+"px"}function p(){r(),s.style.display="block",e.setAttribute("aria-expanded","true"),s.setAttribute("tabindex","-1"),s.focus&&s.focus(),document.addEventListener("click",m,!0),document.addEventListener("keydown",f,!0)}function c(){s.style.display="none",e.setAttribute("aria-expanded","false"),document.removeEventListener("click",m,!0),document.removeEventListener("keydown",f,!0)}function l(){s.style.display==="none"||s.style.display===""?p():c()}function m(t){if(t.target===e||e.contains(t.target)||t.target===s||s.contains(t.target))return;c()}function f(t){(t.key==="Escape"||t.key==="Esc")&&(c(),e.focus&&e.focus()),(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),l())}try{a=e.getAttribute("href"),a&&(a==="#"||a.indexOf("#")===0)&&e.removeAttribute("href")}catch{}e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),l()}),e.addEventListener("keydown",function(e){(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),l())}),window.addEventListener("resize",function(){s.style.display!=="none"&&r()}),window.addEventListener("scroll",function(){s.style.display!=="none"&&r()},!0)})}catch(e){console.error("form__helpers initInfoTooltips error:",e)}}function R(){try{window.formHelpers=window.formHelpers||{};var e=window.formHelpers._deferredInfoTooltips||[];e.forEach(function(e){try{e()}catch{}}),window.formHelpers._deferredInfoTooltips=[]}catch{}}function a(e){var t=e.id||e.getAttribute("name")||"form";return"formstate:"+(location.pathname||"")+":"+t}function m(e){for(var t,s,o,i,r,l,n={},c=e.elements,a=0;a<c.length;a++){if(t=c[a],!t.name&&!t.id)continue;if(s=t.name||t.id,l=(t.tagName||"").toLowerCase(),o=(t.type||"").toLowerCase(),o==="password"||o==="file")continue;if(o==="checkbox")n[s]=t.checked;else if(o==="radio")t.checked&&(n[s]=t.value);else if(l==="select")if(t.multiple){for(r=[],i=0;i<t.options.length;i++)t.options[i].selected&&r.push(t.options[i].value);n[s]=r}else n[s]=t.value;else n[s]=t.value}try{return JSON.stringify(n)}catch{return""}}function L(e){try{var t,n,s,o,r,c,l,d,u,h=a(e),i=sessionStorage.getItem(h);if(!i)return;for(r=JSON.parse(i||"{}"),c=e.elements,o=0;o<c.length;o++){if(t=c[o],!t.name&&!t.id)continue;if(l=t.name||t.id,u=(t.tagName||"").toLowerCase(),d=(t.type||"").toLowerCase(),!(l in r))continue;if(n=r[l],d==="checkbox")t.checked=!!n;else if(d==="radio")t.checked=t.value===n;else if(u==="select")if(t.multiple&&Array.isArray(n))for(s=0;s<t.options.length;s++)t.options[s].selected=n.indexOf(t.options[s].value)!==-1;else t.value=n;else t.value=n}}catch(e){console.error("form__helpers restoreForm error:",e)}}function t(e){try{var n=a(e),t=m(e);sessionStorage.setItem(n,t)}catch(e){console.error("form__helpers saveFormState error:",e)}}function r(e){try{var t=a(e);sessionStorage.removeItem(t)}catch(e){console.error("form__helpers clearFormState error:",e)}}function p(e){e=e||document;try{var s='form.calculator--form, form[data-save="session"]',n=Array.prototype.slice.call(e.querySelectorAll(s));n.forEach(function(e){L(e);var s=null;function o(){s&&clearTimeout(s),s=setTimeout(function(){t(e)},250)}e.addEventListener("input",o,!0),e.addEventListener("change",o,!0),e.addEventListener("submit",function(){var s=e.getAttribute("data-clear-on-submit");s==="true"||s===""?r(e):t(e)},!0)})}catch(e){console.error("form__helpers initFormPersistence error:",e)}}function n(e){e=e||{};var t=e.title||"Are you sure?",n=e.body||"",s=e.okText||"OK",o=e.cancelText||"Cancel";return new Promise(function(e){try{var i,a,c,l,d,h,r=document.createElement("div");r.className="confirm-overlay fixed top-0 left-0 w-100 h-100 flex items-center justify-center",r.style.zIndex=2e4,r.style.background="rgba(0,0,0,0.4)",i=document.createElement("div"),i.className="confirm-box bg-white pa3 br2",i.style.minWidth="320px",i.style.maxWidth="90%",d=document.createElement("h3"),d.textContent=t,d.style.marginTop="0",h=document.createElement("p"),h.innerHTML=n,c=document.createElement("div"),c.className="tr mt3",l=document.createElement("button"),l.className="btn mr2",l.textContent=o,a=document.createElement("button"),a.className="btn btn--primary",a.textContent=s,c.appendChild(l),c.appendChild(a),i.appendChild(d),i.appendChild(h),i.appendChild(c),r.appendChild(i),document.body.appendChild(r);try{a.focus&&a.focus()}catch{}function u(){document.body.removeChild(r),document.removeEventListener("keydown",m,!0)}function m(t){if(t.key==="Escape"||t.key==="Esc"){u(),e(!1);return}if(t.key==="Enter"){u(),e(!0);return}}l.addEventListener("click",function(){u(),e(!1)}),a.addEventListener("click",function(){u(),e(!0)}),document.addEventListener("keydown",m,!0)}catch(t){console.error("showConfirm error:",t),e(!1)}})}function d(e){e=e||document;try{var s,o=Array.prototype.slice.call(e.querySelectorAll('form.calculator--form, form[data-save="session"]'));function t(e){if(!e)return;r(e);try{e.reset()}catch{}try{if(window.history&&typeof window.history.replaceState=="function"){var t,n=new URL(location.href);n.search="",window.history.replaceState({},document.title,n.toString())}else location.search=""}catch(e){console.error("clear-values: could not clear URL token",e)}try{window.history&&typeof window.history.replaceState=="function"?(t=new URL(location.href),t.hash="",window.history.replaceState({},document.title,t.toString())):location.hash=""}catch{}try{if(window.formDime&&typeof window.formDime.expandFromSummary=="function")try{window.formDime.expandFromSummary(e)}catch{}}catch{}e.dispatchEvent(new CustomEvent("form:cleared"))}o.forEach(function(e){var s=e.querySelector(".btn--clear-values");if(!s)return;try{s.setAttribute("data-clear-bound","true")}catch{}s.addEventListener("click",function(s){s.preventDefault(),s.stopPropagation(),n({title:"Clear saved values?",body:"This will clear saved form values for this calculator. Are you sure?",okText:"Yes, clear",cancelText:"Cancel"}).then(function(n){if(!n)return;t(e)})})}),s=Array.prototype.slice.call(e.querySelectorAll(".btn--clear-values")),s.forEach(function(s){if(s.closest("form"))return;if(s.getAttribute&&s.getAttribute("data-clear-bound")==="true")return;try{s.setAttribute("data-clear-bound","true")}catch{}s.addEventListener("click",function(o){o.preventDefault(),o.stopPropagation(),n({title:"Clear saved values?",body:"This will clear saved form values for this calculator. Are you sure?",okText:"Yes, clear",cancelText:"Cancel"}).then(function(n){if(!n)return;var o=s.getAttribute("data-target-form")||e.querySelector("form.calculator--form")&&e.querySelector("form.calculator--form").id||"dime-form",i=document.getElementById(o)||document.querySelector("form.calculator--form");t(i)})})})}catch(e){console.error("initClearValues error:",e)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",function(){u(document),o(document),p(document),d(document),s(document),h(document),i(document),l(document)}):(u(document),o(document),p(document),d(document),s(document),h(document),i(document),l(document));try{document.addEventListener("click",function(e){var t=e.target.closest&&e.target.closest(".btn--clear-values");if(!t)return;if(t.closest&&t.closest("form"))return;if(t.getAttribute&&t.getAttribute("data-clear-bound")==="true")return;e.preventDefault(),n({title:"Clear saved values?",body:"This will clear saved form values for this calculator. Are you sure?",okText:"Yes, clear",cancelText:"Cancel"}).then(function(e){if(!e)return;try{var s=t.getAttribute("data-target-form")||document.querySelector("form.calculator--form")&&document.querySelector("form.calculator--form").id||"dime-form",n=document.getElementById(s)||document.querySelector("form.calculator--form");if(!n)return;try{handleClearForForm(n)}catch{try{n.reset()}catch{}}}catch(e){console.error("delegated clear-values handler error",e)}})},!1)}catch{}try{document.addEventListener("click",function(e){var t,s,n=e.target&&e.target.closest?e.target.closest(".btn--notes-toggle"):null;if(!n)return;if(n.__notes_bound)return;e.preventDefault(),e.stopPropagation();try{if(s=n.getAttribute&&n.getAttribute("data-target-form"),t=null,s&&(t=document.getElementById(s)),t||(t=document.querySelector("form.calculator--form")||document.querySelector("form")),!t)return;window.formHelpers.openNotes(t)}catch{}},!1)}catch{}try{var e,b=new WeakMap;function v(e){try{if(!e)return;var n=b.get(e);n&&clearTimeout(n),b.set(e,setTimeout(function(){try{t(e)}catch{}},250))}catch{}}document.addEventListener("input",function(e){try{var n,t=e.target;if(!t)return;if(n=t.closest&&t.closest("form.calculator--form"),!n)return;v(n)}catch{}},!0),document.addEventListener("change",function(e){try{var n,t=e.target;if(!t)return;if(n=t.closest&&t.closest("form.calculator--form"),!n)return;v(n)}catch{}},!0)}catch{}window.formHelpers=window.formHelpers||{},window.formHelpers.addAsterisks=u,window.formHelpers.initInfoTooltips=o,window.formHelpers.flushDeferredInfoTooltips=R,window.formHelpers.saveFormState=t,window.formHelpers.clearFormState=r,window.formHelpers.showConfirm=n,window.formHelpers.initClearValues=d;function g(e,t){t=t||{};var n,s,o,i,a,r,c=!!t.includeEmpty,l=typeof t.useFragment=="undefined"||!!t.useFragment;try{if(!e||!(e instanceof HTMLFormElement))return"";if(i=m(e)||"{}",o=JSON.parse(i),s=new URLSearchParams,Object.keys(o).forEach(function(e){var t=o[e];if(!c&&(t===null||t===""||typeof t=="undefined"))return;Array.isArray(t)?t.forEach(function(t){s.append(e,t)}):s.append(e,String(t))}),n=s.toString(),l){a=n?"#"+n:"";try{history&&history.replaceState?history.replaceState(null,"",location.pathname+location.search+a):location.hash=n}catch{try{location.hash=n}catch{}}}else{r=location.pathname+(n?"?"+n:"");try{history&&history.replaceState?history.replaceState(null,"",r):location.search=n}catch{try{location.search=n}catch{}}}return n}catch(e){return console.error("form__helpers encodeFormToURLHash error:",e),""}}window.formHelpers.encodeFormToURLHash=g;function s(e){e=e||document;try{var t=Array.prototype.slice.call(e.querySelectorAll("form[data-hash-on-submit]"));t.forEach(function(e){e.addEventListener("submit",function(t){try{t.preventDefault(),g(e,{includeEmpty:!1,useFragment:!0});var n=e.getAttribute("data-submit-after-hash");n==="true"&&e.submit()}catch(e){console.error("initHashOnSubmit submit handler error:",e)}},!0)})}catch(e){console.error("initHashOnSubmit error:",e)}}window.formHelpers.initHashOnSubmit=s;function _(){try{var e,t,n,s=document.getElementById("notes-dialog");if(s)return f(s),s;try{if(e=document.getElementById("notes-dialog-template"),e&&e.content&&(t=e.content.cloneNode(!0),n=t.querySelector&&t.querySelector("dialog"),n))return document.body.appendChild(t),f(n),n}catch{}return null}catch{return null}}function f(e){try{if(!e||e.__notes_bound)return;e.__notes_bound=!0;var i=e.querySelector("#notes-close"),s=e.querySelector("#notes-save"),n=e.querySelector("#notes_dialog_textarea");function a(e,t){try{var n=Array.prototype.slice.call(document.querySelectorAll(".btn--notes-toggle"));n.forEach(function(n){try{var s=n.getAttribute&&n.getAttribute("data-target-form");(!s||!e||s===e)&&n.setAttribute("aria-expanded",t?"true":"false")}catch{}})}catch{}}function o(){try{typeof e.close=="function"?e.close():e.removeAttribute("open")}catch{try{e.removeAttribute("open")}catch{}}try{var t=e.__notes_target_form_id||null}catch{t=null}try{delete e.__notes_target}catch{}try{e.__notes_target_selector=null}catch{}try{e.__notes_target_form_id=null}catch{}a(t,!1)}function r(s){try{s&&typeof s.preventDefault=="function"&&s.preventDefault()}catch{}try{s&&typeof s.stopPropagation=="function"&&s.stopPropagation()}catch{}try{var a,r,c,l=n&&n.value?n.value.trim():"",i=e.__notes_target;if(i&&i.tagName){try{i.value=l}catch{}try{i.dispatchEvent(new Event("change",{bubbles:!0}))}catch{}try{if(r=i&&i.closest?i.closest("form"):null,r)try{t(r)}catch{}}catch{}}else if(e.__notes_target_selector)try{if(a=document.querySelector(e.__notes_target_selector),a){a.value=l;try{a.dispatchEvent(new Event("change",{bubbles:!0}))}catch{}}try{if(c=a&&a.closest?a.closest("form"):null,c)try{t(c)}catch{}}catch{}}catch{}}catch{}o()}i&&i.addEventListener("click",function(){o()},!0),s&&s.addEventListener("click",r,!0),e.__openFor=function(t,s){try{var r,c,l,d,o=null,i=null;if(s&&t){i=s.charAt&&s.charAt(0)==="#"?s:"#"+s;try{o=t.querySelector(i)}catch{o=null}}if(!o&&t&&(c=t.querySelector('textarea[id^="notes_"]')||t.querySelector('textarea[name^="notes"]')||t.querySelector("#expense_notes")||t.querySelector("textarea[data-notes]"),c&&(o=c,i="#"+(c.id||c.name))),!o&&i&&t)try{l=i.replace(/^#/,""),r=document.createElement("textarea"),r.id=l,r.name=l,r.style.display="none",t.appendChild(r),o=r}catch{o=null}e.__notes_target=o,e.__notes_target_selector=i||null;try{e.__notes_target_form_id=t&&(t.id||t.getAttribute&&t.getAttribute("name"))?t.id||t.getAttribute("name"):null}catch{e.__notes_target_form_id=null}try{n&&(n.value=o&&o.value?o.value:"")}catch{n&&(n.value="")}try{typeof e.showModal=="function"?e.showModal():e.setAttribute("open","")}catch{e.setAttribute("open","")}try{n&&(n.focus(),d=n.value||"",n.selectionStart=n.selectionEnd=d.length)}catch{}try{a(e.__notes_target_form_id,!0)}catch{}}catch{}},e.__close=function(){o()}}catch{}}function N(e,t){try{var n=_();if(!n)return;n.__openFor(e,t)}catch{}}function A(){try{var e=document.getElementById("notes-dialog");e&&typeof e.__close=="function"&&e.__close()}catch{}}window.formHelpers.ensureNotesDialog=_,window.formHelpers.openNotes=N,window.formHelpers.closeNotes=A;function j(e){try{var t=c(e).buffer;return w(t)}catch(e){return console.error("base64UrlEncode error:",e),""}}function y(e){try{if(!e||typeof e!="string")return"";if(!/^[A-Za-z0-9_-]*$/.test(e))return"";for(var t,s,o,i,n=e.replace(/-/g,"+").replace(/_/g,"/");n.length%4;)n+="=";for(s=atob(n),o=s.length,i=new Uint8Array(o),t=0;t<o;t++)i[t]=s.charCodeAt(t);return(new TextDecoder).decode(i)}catch(t){return e&&/^[A-Za-z0-9_-]+$/.test(e)&&console.error("base64UrlDecode error:",t),""}}function c(e){return(new TextEncoder).encode(e)}function w(e){for(var o,n="",s=new Uint8Array(e),t=0;t<s.byteLength;t++)n+=String.fromCharCode(s[t]);return o=btoa(n),o.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function T(e){try{if(window._formHelpersHmacKeyCache=window._formHelpersHmacKeyCache||{},window._formHelpersHmacKeyCache[e])return window._formHelpersHmacKeyCache[e];var n=c(e),t=crypto.subtle.importKey("raw",n,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"]);return window._formHelpersHmacKeyCache[e]=t,t}catch(e){return Promise.reject(e)}}function x(e,t){return async function(){var n=c(e),s=await T(t),o=await crypto.subtle.sign("HMAC",s,n);return w(o)}()}function F(e,t){t=t||{};try{var o=m(e)||"{}",n=j(o),s=t.salt||null;return s?x(n,s).then(function(e){return n+"."+e}).catch(function(e){return console.error("createTokenFromForm (signed) error:",e),n}):Promise.resolve(n)}catch(e){return console.error("createTokenFromForm error:",e),Promise.resolve("")}}function E(e,t){t=t||{};try{if(!e)return Promise.resolve({});var a=(""+e).split("."),n=a[0]||"",s=a[1]||null,r=y(n),o=JSON.parse(r||"{}"),i=t.salt||null;return!s||!i?Promise.resolve(o):x(n,i).then(function(e){if(e===s)return o;throw new Error("signature-mismatch")}).catch(function(e){return console.error("decodeTokenToObject verification failed:",e),{}})}catch(e){return console.error("decodeTokenToObject error:",e),Promise.resolve({})}}function M(e,t){t=t||{};try{if(!e){history&&history.replaceState?history.replaceState(null,"",location.pathname+location.hash):location.search="";return}var n="?"+e;history&&history.replaceState?history.replaceState(null,"",location.pathname+n+location.hash):location.search=e}catch{try{location.search=e}catch(e){console.error("writeTokenToQuery error:",e)}}}function S(e,t){return async function(){try{var n,s,o,a,r,c,l,d,i=await E(e||"");if(!t||!i)return{};for(r=t.elements,a=0;a<r.length;a++){if(n=r[a],!n.name&&!n.id)continue;if(c=n.name||n.id,!(c in i))continue;if(d=(n.tagName||"").toLowerCase(),l=(n.type||"").toLowerCase(),s=i[c],l==="checkbox")n.checked=!!s&&(s===!0||s==="1"||s===1);else if(l==="radio")n.checked=n.value===s;else if(d==="select")if(n.multiple&&Array.isArray(s))for(o=0;o<n.options.length;o++)n.options[o].selected=s.indexOf(n.options[o].value)!==-1;else n.value=s;else n.value=s}try{t.dispatchEvent(new Event("change",{bubbles:!0}))}catch{}return i}catch(e){return console.error("populateFormFromToken error:",e),{}}}()}window.formHelpers.base64UrlEncode=j,window.formHelpers.base64UrlDecode=y,window.formHelpers.createTokenFromForm=F,window.formHelpers.decodeTokenToObject=E,window.formHelpers.writeTokenToQuery=M,window.formHelpers.populateFormFromToken=S,e={enc:function(e){try{for(var s="",n=new Uint8Array(e),t=0;t<n.byteLength;t++)s+=String.fromCharCode(n[t]);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}catch{return""}},dec:function(e){try{for(var t,n,o,s=(e||"").replace(/-/g,"+").replace(/_/g,"/");s.length%4;)s+="=";for(n=atob(s),o=new Uint8Array(n.length),t=0;t<n.length;t++)o[t]=n.charCodeAt(t);return o}catch{return new Uint8Array}}};async function k(e,t){var n=new TextEncoder,s=await crypto.subtle.importKey("raw",n.encode(e),{name:"PBKDF2"},!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},s,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function C(t,n){var i=new TextEncoder,s=crypto.getRandomValues(new Uint8Array(12)),o=crypto.getRandomValues(new Uint8Array(16)),a=await k(n,o),r=i.encode(JSON.stringify(t)),c=await crypto.subtle.encrypt({name:"AES-GCM",iv:s},a,r);return{ct:e.enc(c),iv:e.enc(s),salt:e.enc(o)}}async function O(t,n){var s=new TextDecoder,o=e.dec(t.iv||""),i=e.dec(t.salt||""),a=e.dec(t.ct||""),r=await k(n,i),c=await crypto.subtle.decrypt({name:"AES-GCM",iv:o},r,a);return JSON.parse(s.decode(c))}async function z(e,t){try{if(!e)return"";var s,o,i,a,r,n=t||null;if(!n)try{s=e.getAttribute&&e.getAttribute("data-protect-id")?e.getAttribute("data-protect-id"):"default",n=sessionStorage.getItem("password_gate:"+s)||localStorage.getItem("password_gate:"+s)||null}catch{n=null}return n?(o={},i=new FormData(e),i.forEach(function(e,t){o[t]=e}),a=await C(o,n),r=new URLSearchParams(a).toString(),location.origin+location.pathname+"?"+r+"#key="+encodeURIComponent(n)):""}catch(e){return console.error("createEncryptedShareUrl error:",e),""}}async function D(e,t,n,s){try{var o,i,r,a={ct:e.get("ct"),iv:e.get("iv"),salt:e.get("salt")};if(!a.ct||!a.iv||!a.salt)return!1;if(o=t||null,!o&&n)try{r=n.getAttribute&&n.getAttribute("data-protect-id")?n.getAttribute("data-protect-id"):"default",o=sessionStorage.getItem("password_gate:"+r)||localStorage.getItem("password_gate:"+r)||null}catch{o=null}if(!o)return!1;if(i=await O(a,o),!n||!i)return!0;Object.keys(i).forEach(function(e){try{var s,t=n.elements[e]||document.querySelector('[name="'+e+'"]')||document.getElementById(e);if(!t)return;if(t.length&&typeof t!="string")for(s=0;s<t.length;s++)try{t[s].value=i[e]}catch{}else try{t.value=i[e]}catch{}}catch{}});try{n.dispatchEvent(new Event("change",{bubbles:!0}))}catch{}try{window.Tracking&&typeof window.Tracking.sendEvent=="function"&&window.Tracking.sendEvent("encrypted_url_accessed",{event_category:"engagement",event_label:"encrypted_form_data",form_type:n.id||n.className||"unknown",decryption_source:s||"unknown"})}catch(e){console.warn("Encrypted URL access tracking failed:",e)}return!0}catch{return!1}}window.formHelpers.encryptJSON=C,window.formHelpers.decryptJSON=O,window.formHelpers.createEncryptedShareUrl=z,window.formHelpers.tryDecryptSearchToForm=D;function h(e){e=e||document;try{var n,s,o,i,a,r,c,l,d,u,h,m,f,p,v,t=document.getElementById("dime-form")||document.querySelector("form.calculator--form")||null;if(!t)return;function g(e){if(!e)return null;var t=e.replace(/^#/,"");return t?new URLSearchParams(t):null}if(o=(location.search||"").replace(/^\?/,""),o){try{if(n=new URLSearchParams(location.search.replace(/^\?/,"")),n.get("ct")&&n.get("iv")&&n.get("salt")){if(c=(location.hash||"").match(/key=([^&]+)/),c){f=decodeURIComponent(c[1]);try{window.formHelpers.tryDecryptSearchToForm(n,f,t,"url_fragment_key").then(function(){});return}catch{}}try{m=t&&t.getAttribute?t.getAttribute("data-protect-id")||"default":"default",i=null;try{i=localStorage.getItem("password_gate:"+m)||null}catch{i=null}if(i){window.formHelpers.tryDecryptSearchToForm(n,i,t,"stored_password").then(function(){});return}}catch{}}}catch{}try{if(n=new URLSearchParams(o),n.get("ct")||n.get("iv")||n.get("salt"))return;o&&/^[A-Za-z0-9_-]+(\.[A-Za-z0-9_-]+)?$/.test(o)&&window.formHelpers.populateFormFromToken(o,t);return}catch{}}if(l=(location.hash||"").replace(/^#/,""),!l)return;if(l.indexOf("=")!==-1){if(d=g(location.hash),!d)return;for(h of d.entries()){if(r=h[0],a=h[1],s=t.elements[r]||t.querySelector("#"+r),!s)continue;v=(s.tagName||"").toLowerCase(),u=(s.type||"").toLowerCase();try{u==="checkbox"?s.checked=a==="1"||a==="true":u==="radio"?(p=t.querySelectorAll('input[name="'+r+'"]'),p.forEach(function(e){e.value===a&&(e.checked=!0)})):s.value=a}catch{}}try{t.dispatchEvent(new Event("change",{bubbles:!0}))}catch{}return}try{window.formHelpers.populateFormFromToken(location.hash.replace(/^#/,""),t)}catch{}}catch(e){console.error("initPrefillFromURL error:",e)}}window.formHelpers.initPrefillFromURL=h;function i(e){e=e||document;try{var t,n,s,o,i,r=document.getElementById("btn-add-key");if(!r)return;t=document.getElementById("add-key-dialog"),n=t?t.querySelector("#add_key_input"):null,i=t?t.querySelector("#add-key-close"):null,o=t?t.querySelector("#add-key-submit"):null,s=t?t.querySelector("#add-key-error"):null;function c(){try{if(!t)return;typeof t.showModal=="function"?t.showModal():t.setAttribute("open","")}catch{t.setAttribute("open","")}n&&(n.value="",setTimeout(function(){n.focus()},10))}function a(){try{if(!t)return;typeof t.close=="function"?t.close():t.removeAttribute("open")}catch{t.removeAttribute("open")}}function l(e){if(!e)return!1;var t=(e||"").replace(/^[#?]/,"").trim();return!!t&&!/\s/.test(t)&&t.indexOf("&")===-1}function d(e){if(e=(e||"").replace(/^[#?]/,""),!e)return;try{if(history&&history.replaceState){var t,n,s=new URL(location.href);s.search=e?"?"+e:"",history.replaceState({},document.title,s.toString())}else location.search=e?"?"+e:""}catch{try{location.search=e?"?"+e:""}catch{}}if(t=document.getElementById("dime-form")||document.querySelector("form.calculator--form"),!t)return;try{n=window.formHelpers.populateFormFromToken(e,t),n&&typeof n.then=="function"&&n.then(function(){try{if(window.formDime)window.formDime.renderDebtOutput&&window.formDime.renderDebtOutput(t),window.formDime.renderIncomeOutput&&window.formDime.renderIncomeOutput(t),window.formDime.renderMortgageOutput&&window.formDime.renderMortgageOutput(t),window.formDime.renderEducationOutput&&window.formDime.renderEducationOutput(t),window.formDime.renderDimeOutput&&window.formDime.renderDimeOutput(t),window.formDime.renderCoverageNeed&&window.formDime.renderCoverageNeed(t);else try{t.dispatchEvent(new Event("submit",{bubbles:!0}))}catch{}}catch{}}).catch(function(){})}catch{}}r.addEventListener("click",function(e){if(e.preventDefault(),!t){var n,s,o,a,r,i=window.prompt('Paste full query (must start with "ct=...&iv=...&salt=..."):',"");if(!i)return;if(n=i.trim(),!(n.indexOf("ct=")===0&&/ct=/.test(n)&&/iv=/.test(n)&&/salt=/.test(n))){try{alert('Invalid input. Only encrypted ciphertext in the form "ct=...&iv=...&salt=..." is accepted.')}catch{}return}a=new URLSearchParams(n.replace(/^\?/,"")),s=document.getElementById("dime-form")||document.querySelector("form.calculator--form");try{r=s&&s.getAttribute?s.getAttribute("data-protect-id")||"default":"default",o=null;try{o=localStorage.getItem("password_gate:"+r)||null}catch{o=null}if(!o){try{alert("No stored passphrase found in localStorage. Please unlock the protected content first before adding an encrypted key.")}catch{}return}window.formHelpers.tryDecryptSearchToForm(a,o,s,"add_key_action").then(function(e){if(!e){try{alert("Decryption failed")}catch{}return}if(window.Tracking)window.Tracking.addKeySuccess("prompt");else try{var t="";try{t=localStorage.getItem("ga4_user_name")||sessionStorage.getItem("ga4_user_name")||"anonymous"}catch{t="anonymous"}window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"add_key_success",user_name:t,key_method:"prompt",event_category:"engagement",event_label:"add_encrypted_key"})}catch(e){console.warn("GA4 tracking error:",e)}try{s.dispatchEvent(new Event("submit",{bubbles:!0}))}catch{}})}catch{try{alert("Failed to apply key")}catch{}}return}c()},!0),i&&i.addEventListener("click",function(){a()},!0),t&&t.addEventListener("cancel",function(e){e.preventDefault(),a()},!0),o&&n&&(o.addEventListener("click",function(e){e.preventDefault();var t,i,r,c,l,o=(n.value||"").trim();if(!o){s&&(s.style.display="block"),n&&n.focus();return}if(/ct=/.test(o)&&/iv=/.test(o)&&/salt=/.test(o)){if(r=o.replace(/^[#?]/,"").trim(),r.indexOf("ct=")!==0){s&&(s.style.display="block",s.textContent='Encrypted key must start with "ct="'),n&&n.focus();return}c=new URLSearchParams(r.replace(/^\?/,"")),t=document.getElementById("dime-form")||document.querySelector("form.calculator--form");try{l=t&&t.getAttribute?t.getAttribute("data-protect-id")||"default":"default",i=null;try{i=localStorage.getItem("password_gate:"+l)||null}catch{i=null}if(!i){s&&(s.style.display="block",s.textContent="No stored passphrase found. Please unlock the content first."),n&&n.focus();return}window.formHelpers.tryDecryptSearchToForm(c,i,t,"share_url_input").then(function(e){if(!e){try{alert("Decryption failed")}catch{}return}if(window.Tracking)window.Tracking.addKeySuccess("dialog");else try{var n="";try{n=localStorage.getItem("ga4_user_name")||sessionStorage.getItem("ga4_user_name")||"anonymous"}catch{n="anonymous"}window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"add_key_success",user_name:n,key_method:"dialog",event_category:"engagement",event_label:"add_encrypted_key"})}catch(e){console.warn("GA4 tracking error:",e)}try{t.dispatchEvent(new Event("submit",{bubbles:!0}))}catch{}})}catch{s&&(s.style.display="block")}a();return}s&&(s.style.display="block",s.textContent='Invalid key. Paste encrypted ciphertext starting with "ct=...&iv=...&salt=...".'),n&&n.focus()},!0),n.addEventListener("keydown",function(e){e.key==="Enter"&&(e.preventDefault(),o.click())},!0),n.addEventListener("input",function(){s&&(s.style.display="none")},!0))}catch(e){console.error("initAddKeyButton error:",e)}}window.formHelpers.initAddKeyButton=i;function l(e){e=e||document;try{var t=Array.prototype.slice.call(e.querySelectorAll("#btn-toggle-notes, .btn--notes-toggle"));t.forEach(function(e){if(e.__notes_bound)return;e.__notes_bound=!0,e.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation();var s=e.getAttribute&&e.getAttribute("data-target-form"),n=null;if(s&&(n=document.getElementById(s)),n||(n=document.querySelector("form.calculator--form")||document.querySelector("form")),!n)return;try{window.formHelpers.openNotes(n)}catch{}},!0)})}catch{}}window.formHelpers.initNotesButton=l})()