<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>{{ .Title }}</title>
    {{ partial "site-style.html" . }}
    <style>
      /* Hide access buttons by default to avoid flash before JS runs.
         PasswordGate will reveal individual buttons by adding
         the `pw-access-visible` class to the matching button. */
      .pw-buttons-hidden .btn--access-content { display: none; }
      .pw-buttons-hidden .btn--access-content.pw-access-visible { display: inline-block; }
      /* Hide the calculator action bar until JS decides it's visible */
      .pw-action-hidden { visibility: hidden; }
    </style>
</head>
<body class="calculator-page pw-buttons-hidden">
  <main class="calculator-page__content flex flex-column items-center justify-center min-vh-100" {{ if isset .Params "password" }}data-protect-password="{{ .Params.password }}"{{ end }}>
      {{ .Content }}
    </main>
      {{/* Load base form helpers */}}
      {{ with resources.Get "js/form__helpers.js" }}
        {{ $fh := . }}
        {{ if hugo.IsProduction }}
          {{ $fh = $fh | minify | fingerprint }}
        {{ end }}
          <script src="{{ $fh.RelPermalink }}"></script>
        {{ else }}
          <script src="/assets/js/form__helpers.js"></script>
        {{ end }}

        {{/* Calculator-specific scripts */}}
        {{ if in .File.Path "calculator" }}
          {{/* Load password gate for any calculator page */}}
          {{ with resources.Get "js/password__hide-content.js" }}
          {{ $p := . }}
          {{ if hugo.IsProduction }}
            {{ $p = $p | minify | fingerprint }}
          {{ end }}
            <script src="{{ $p.RelPermalink }}"></script>
          {{ else }}
            <script src="/assets/js/password__hide-content.js"></script>
          {{ end }}

          {{/* DIME calculator specific script only for dime page */}}
          {{ if in .File.Path "calculator/dime" }}
            {{ with resources.Get "js/form__dime-calculator.js" }}
            {{ $d := . }}
            {{ if hugo.IsProduction }}
              {{ $d = $d | minify | fingerprint }}
            {{ end }}
              <script src="{{ $d.RelPermalink }}"></script>
            {{ else }}
              <script src="/assets/js/form__dime-calculator.js"></script>
            {{ end }}
          {{ end }}
        {{ end }}

  {{/* Fixed action bar for calculator pages. Allow pages to set .form_id or override action_bar_buttons in front matter. */}}
  {{ $formID := .Params.form_id }}
  {{ $buttons := .Params.action_bar_buttons }}
  {{ if $buttons }}
    {{ partial "fixed-action-bar.html" (dict "Buttons" $buttons "FormID" $formID "Page" .) }}
  {{ else }}
    {{ partial "fixed-action-bar.html" (dict "FormID" $formID "Page" .) }}
  {{ end }}

  {{/* Notes dialog partial - only included on calculator pages */}}
  {{ partial "notes-dialog.html" . }}

</body>
</html>
